# @package model.onset
# Stage 1: Onset prediction model configuration
# Architecture: TCN (local temporal patterns) + Transformer (global context)
d_model: 512
nhead: 8
num_layers: 2
num_difficulties: 5
num_genres: 1  # Disabled — 100% of maps have genre="unknown", embedding was pure noise
dropout: 0.1

# TCN parameters (local temporal pattern detection)
tcn_channels: 128        # Number of channels in TCN blocks
tcn_num_blocks: 6        # 6 blocks with dilations 1,2,4,8,16,32
tcn_kernel_size: 3        # Kernel size for dilated convolutions
# tcn_dilations: null     # Default: powers of 2 (1,2,4,8,16,32)

# Conditioning dropout for Classifier-Free Guidance
conditioning_dropout: 0.2  # 20% dropout on difficulty/genre embeddings during training

# Memory optimization (set true when VRAM is limited, e.g. gaming in background)
gradient_checkpointing: false

# Training
learning_rate: 0.0003
weight_decay: 0.01
label_smoothing_sigma: 2  # Gaussian smoothing width in frames (sharper peaks)
pos_weight: 1.0  # No class reweighting — Gaussian smoothing already covers timing tolerance

# Dataset windowing
window_size: 1024  # Frames per sliding window (~12 seconds of context)
hop: 512  # Hop between windows

# Difficulty filtering (null = all difficulties)
difficulties:
  - Expert
  - ExpertPlus

# Inference
onset_threshold: 0.35  # Lower threshold for conservative model (precision > recall)
min_onset_distance_ms: 50  # Minimum gap between onsets
min_onset_distance_frames: 5  # Minimum frames between predicted onsets
